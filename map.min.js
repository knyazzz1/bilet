if (typeof lsport == "undefined" || !lsport) window.lsport = {};
window.lsport.map = {
    strings: {
        NoValidGeoCoderResult: "Не найдено соответствий на карте",
        CustomLocationTitle: "Место, указанное на карте",
        SelectOrEnterCourt: "Название спортзала/площадки (Что спросить на вахте). Выберите из списка или введите название",
        CourtNamePlaceholder: "Название (например Большой зал, Бассейн)",
        Cancel: "Отмена",
        ChooseCourt: "Выбрать спортзал/площадку",
        AddAndSelectCourts: "Добавить/выбрать площадки и спортзалы",
        CourtNamesPlaceholder: "Названия новых площадок (через запятую)",
        UseCourts: "Добавить выбранные",
        Court: "Спортзал/Площадка",
        CourtNameRequired: "Введите название спортзала/площадки",
        EnterNewLocationName: "Введите название этого места",
        LocationName: "Название",
        AddNewLocation: "Запомнить это место",
        ConfirmDeleteCourt: "Вы действительно хотите удалить этот спортзал/площадку из списка?",
        ConfirmDeleteLocation: "Вы действительно хотите удалить это место из списка?"
    },
    geocoder: null,
    address2point: function (city, address, callback) {
        if (!window.lsport.map.geocoder) window.lsport.map.geocoder = ymaps;
        window.lsport.map.geocoder.geocode((city ? city + ", " : "") + address, { results: 1 }).then(function (res) {
            callback(res.geoObjects.get(0).geometry.getCoordinates());
        });
    },
    winContainer: null,
    mapContainer: null,
    open: false,
    center: null,
    showMapPoint: function (point, title, address) {
        if (lsport.map.open) return;
        lsport.map.open = true;
        lsport.map.center = !point.length ? point : [point[0], point[1]]
        if (!lsport.map.winContainer) {
            lsport.map.winContainer = $('<div class="modal fade bs-modal-lg" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-lg modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body"><div class="cnt-map" style="width:100%;height:450px"></div></div></div></div></div>').appendTo($("body"));
            lsport.map.mapContainer = lsport.map.winContainer.find(".cnt-map")[0];
            lsport.map.winContainer.on('shown.bs.modal', function () {
                $(document).off('focusin.modal');
                var map = $(lsport.map.mapContainer).data("map");
                if (!map) {
                    var mapOptions = {
                        zoom: 15,
                        center: lsport.map.center,
                        scrollwheel: true
                    }
                    map = new ymaps.Map(lsport.map.mapContainer, mapOptions);
                    $(lsport.map.mapContainer).data("map", map);
                }
                map.setCenter(lsport.map.center);

                var marker;
                if (marker = $(lsport.map.mapContainer).data("marker")) map.geoObjects.remove(marker);
                marker = new ymaps.Placemark(map.getCenter(), {
                    balloonContentBody: '<address><strong>' + title + '</strong><br/>' +  address + '</address>'
                }, {
                    preset: 'islands#redDotIcon'
                });
                $(lsport.map.mapContainer).data("marker", marker);
                map.geoObjects.add(marker);
            }).on('hidden.bs.modal', function () {
                lsport.map.open = false;
            });
        }
        lsport.map.winContainer.modal('show');
    },
    showMap: function (e) {
        var el = $(e).attr("point") || $(e).attr("data-point") || $(e).attr("data-city") || $(e).attr("city") ? $(e) : ($(this).attr("point") || $(this).attr("data-point") || $(this).attr("data-city") || $(this).attr("city") ? $(this) : (e.currentTarget ? $(e.currentTarget) : $(e.target)));
        if (e && e.currentTarget) jQuery.Event(e).preventDefault();

        var location = $(el).data("location");
        if (location) {
            jQuery.Event(e).preventDefault();
            var point = location.Point && location.Point.join ? location.Point : (location.Point ? eval("[" + location.Point + "]") : (location.point ? eval("[" + location.point + "]") : null));
            if (!point) {
                lsport.map.address2point(location.City, location.Address, function (point) {
                    lsport.map.showMapPoint(point, location.Complex, location.Address);
                });
            } else {
                lsport.map.showMapPoint(point, location.Complex, location.Address);
            }
        } else {
            if (el && el.length) {
                var point = $(el).attr("data-point") ? eval("[" + $(el).attr("data-point") + "]") : null;
                if (!point) {
                    lsport.map.address2point($(el).attr("data-city"), $(el).attr("data-address"), function (point) {
                        lsport.map.showMapPoint(point, $(el).attr("data-name"), $(el).attr("data-address"));
                    });
                } else {
                    lsport.map.showMapPoint(point, $(el).attr("data-name"), $(el).attr("data-address"));
                }
            }
        }
    },
    editor:{
        deleteCourt: function (courtID, successCallback, failureCallback) {
            if (!confirm(lsport.map.strings.ConfirmDeleteCourt)) return;
            $.ajax({
                type: "POST",
                url: "/data/court/delete/" + courtID,
                dataType: "json",
                contentType: "application/json; charset=utf-8",
                error: function (jqXhr) {
                    var resp = JSON.parse(jqXhr.responseText);
                    if (resp.Message) alert(resp.ExceptionMessage ? resp.ExceptionMessage : (resp.MessageDetail ? resp.MessageDetail : resp.Message));
                    else if ($.isArray(resp)) {
                        alert($.map(resp, function (itm) { return itm.value; }).join("\n"));
                    }
                    failureCallback();
                },
                success: function (resp) {
                    successCallback();
                }
            });
        }
    },
    selector: {
        select: function (current, callback, orgID) {
            if (!lsport.map.winSelect) {
                var cnt = $('<div class="modal fade bs-modal-lg" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-dialog" style="width:80%;max-width:none"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button></div><div class="modal-body" style="width:100%"></div></div></div></div>').appendTo($("body")).on("shown.bs.modal", function (e) {
                    $(document).off('focusin.modal');
                    lsport.map.winSelect.container.empty();
                    lsport.map.winSelect.container.block(loaderSettings).load("/Complex/SelectLocation" + (orgID ? "/" + orgID : ""), { time: new Date() }, function (resp, status, xReq) { });
                });
                lsport.map.winSelect = cnt;
                lsport.map.winSelect.container = cnt.find(".modal-body");
            }
            lsport.map.winSelect.current = current;
            lsport.map.winSelect.callback = callback;
            lsport.map.winSelect.modal("show");
        },
        selectCourtRO: function (item, selection, callback) {
            if (!lsport.map.selector.winCourtRO) {
                var cnt = $('<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-dialog" style="width:80%;max-width:none"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>' + lsport.map.strings.SelectOrEnterCourt + '</h3></div><div class="modal-body"><div class="form-group row"><div class="col-sm-offset-1 col-sm-10"><input type="text" style="width:100%" placeholder="' + lsport.map.strings.CourtNamePlaceholder + '" /></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default">' + lsport.map.strings.Cancel + '</button><button type="button" class="btn btn-success btn-lg">' + lsport.map.strings.ChooseCourt + '</button></div></div></div></div>').appendTo($("body"));
                lsport.map.selector.winCourtRO = cnt;
                lsport.map.selector.winCourtRO.complex = item;
                lsport.map.selector.winCourtRO.combo = cnt.find("input[type=text]").kendoDropDownList({
                    dataTextField: "Text",
                    dataValueField: "ID",
                    template: kendo.template("<div class='row' style='margin:0px'><div class='col-sm-12'>#=Text#</div></div>"),
                    dataBound: function (e) {
                        var dd = e.sender;
                        $(dd.list).find("button[data-court]").click(function (e) {
                            e.preventDefault();
                            $(e.currentTarget).closest("div.row").block(loaderSettings);
                            var courtID = $(e.currentTarget).attr("data-court");
                            lsport.map.editor.deleteCourt(courtID, function () {
                                var dataItem = dd.dataSource.get(courtID);
                                $(e.currentTarget).closest("div.row").unblock();
                                dd.dataSource.remove(dataItem);
                            }, function () {
                                $(e.currentTarget).closest("div.row").unblock();
                            });
                        });
                    },
                    dataSource: new kendo.data.DataSource({
                        type: "json",
                        serverPaging: false,
                        serverSorting: false,
                        serverFiltering: false,
                        editable: false,
                        transport: {
                            read: {
                                url: "/data/court/List",
                                dataType: "text",
                                type: "POST",
                                contentType: "application/json; charset=utf-8"
                            },
                            parameterMap: function (options) {
                                options.complexID = lsport.map.selector.winCourtRO.complex.ComplexID;
                                return JSON.stringify(options);
                            }
                        },
                        sort: { field: "Text", dir: "asc" },
                        schema:
                        {
                            parse: function (resp) { return $.parseJSON(resp, true); },
                            data: function (resp) { return resp && resp.items ? resp.items : []; },
                            total: function (resp) { return resp && resp.total ? resp.total : 0; },
                            errors: function (resp) { return resp && resp.Message ? resp.Message : null; },
                            model: {
                                id: "ID"
                            }
                        }
                    }),
                }).data("kendoDropDownList");
                cnt.find("button.btn-default").click(function (e) { lsport.map.selector.winCourtRO.modal('hide'); });
                cnt.find("button.btn-success").click(function (e) {
                    var courtID = lsport.map.selector.winCourtRO.combo.value();
                    if (lsport.map.selector.winCourtRO.combo.dataItem()) {
                        lsport.map.selector.winCourtRO.callback({ CourtID: courtID, Name: lsport.map.selector.winCourtRO.combo.text() });
                        lsport.map.selector.winCourtRO.modal('hide');
                    } else {
                        alert("Площадка не указана");
                    }
                });
            } else {
                lsport.map.selector.winCourtRO.complex = item;
                lsport.map.selector.winCourtRO.combo.dataSource.read();
            }
            lsport.map.selector.winCourtRO.selection = selection;
            if (selection && selection.length) lsport.map.selector.winCourtRO.combo.value(selection[0]);
            lsport.map.selector.winCourtRO.callback = callback;
            lsport.map.selector.winCourtRO.modal('show');
        },
        selectCourt: function (item, selection, callback) {
            if (!lsport.map.selector.winCourt) {
                var cnt = $('<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-dialog" style="width: 500px"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>' + lsport.map.strings.SelectOrEnterCourt + '</h3></div><div class="modal-body"><div class="form-group row"><div class="col-sm-offset-1 col-sm-10"><input type="text" style="width:100%" placeholder="' + lsport.map.strings.CourtNamePlaceholder + '" /></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default">' + lsport.map.strings.Cancel + '</button><button type="button" class="btn btn-success btn-lg">' + lsport.map.strings.ChooseCourt + '</button></div></div></div></div>').appendTo($("body"));
                lsport.map.selector.winCourt = cnt;
                lsport.map.selector.winCourt.complex = item;
                lsport.map.selector.winCourt.combo = cnt.find("input[type=text]").kendoComboBox({
                    dataTextField: "Text",
                    dataValueField: "ID",
                    template: kendo.template("<div class='row' style='margin:0px'><div class='col-sm-2'># if (!(lsport.map.selector.winCourt.selection.indexOf(data.ID)+1)) {# <button class='btn btn-danger btn-sm' data-court='#=ID#'><span class='fas fa-trash'></span></button>#}#</div><div class='col-sm-10'>#=Text#</div></div>"),
                    dataBound: function (e) {
                        var dd = e.sender;
                        $(dd.list).find("button[data-court]").click(function (e) {
                            e.preventDefault();
                            $(e.currentTarget).closest("div.row").block(loaderSettings);
                            var courtID = $(e.currentTarget).attr("data-court");
                            lsport.map.editor.deleteCourt(courtID, function () {
                                var dataItem = dd.dataSource.get(courtID);
                                $(e.currentTarget).closest("div.row").unblock();
                                dd.dataSource.remove(dataItem);
                            }, function () {
                                $(e.currentTarget).closest("div.row").unblock();
                            });
                        });
                    },
                    dataSource: new kendo.data.DataSource({
                        type: "json",
                        serverPaging: false,
                        serverSorting: false,
                        serverFiltering: false,
                        editable: false,
                        transport: {
                            read: {
                                url: "/data/court/List",
                                dataType: "text",
                                type: "POST",
                                contentType: "application/json; charset=utf-8"
                            },
                            parameterMap: function (options) {
                                options.complexID = lsport.map.selector.winCourt.complex.ComplexID;
                                return JSON.stringify(options);
                            }
                        },
                        sort: { field: "Text", dir: "asc" },
                        schema:
                        {
                            parse: function (resp) { return $.parseJSON(resp, true); },
                            data: function (resp) { return resp && resp.items ? resp.items : []; },
                            total: function (resp) { return resp && resp.total ? resp.total : 0; },
                            errors: function (resp) { return resp && resp.Message ? resp.Message : null; },
                            model: {
                                id: "ID"
                            }
                        }
                    })
                }).data("kendoComboBox");
                cnt.find("button.btn-default").click(function (e) { lsport.map.selector.winCourt.modal('hide'); });
                cnt.find("button.btn-success").click(function (e) {
                    var courtID = lsport.map.selector.winCourt.combo.value();
                    if (lsport.map.selector.winCourt.combo.dataItem()) {
                        lsport.map.selector.winCourt.callback({ CourtID: courtID, Name: lsport.map.selector.winCourt.combo.text() });
                        lsport.map.selector.winCourt.modal('hide');
                    }
                    else {
                        lsport.map.selector.winCourt.find(".modal-content").block(loaderSettings);
                        $.ajax({
                            type: "POST",
                            url: "/data/court/create",
                            data: JSON.stringify({
                                Name: lsport.map.selector.winCourt.combo.text(),
                                ComplexID: lsport.map.selector.winCourt.complex.ComplexID
                            }),
                            dataType: "json",
                            contentType: "application/json; charset=utf-8",
                            error: function (jqXhr) {
                                lsport.map.selector.winCourt.find(".modal-content").unblock();
                                var resp = JSON.parse(jqXhr.responseText);
                                if (resp.Message) alert(resp.ExceptionMessage ? resp.ExceptionMessage : (resp.MessageDetail ? resp.MessageDetail : resp.Message));
                                else if ($.isArray(resp)) {
                                    alert($.map(resp, function (itm) { return itm.value; }).join("\n"));
                                }
                            },
                            success: function (resp) {
                                lsport.map.selector.winCourt.find(".modal-content").unblock();
                                lsport.map.selector.winCourt.callback({ CourtID: resp[0].ID, Name: resp[0].Text });
                                lsport.map.selector.winCourt.modal('hide');
                            }
                        });
                    }
                });
            } else {
                lsport.map.selector.winCourt.complex = item;
                lsport.map.selector.winCourt.combo.dataSource.read();
            }
            lsport.map.selector.winCourt.selection = selection;
            if (selection && selection.length) lsport.map.selector.winCourt.combo.value(selection[0]);
            lsport.map.selector.winCourt.callback = callback;
            lsport.map.selector.winCourt.modal('show');
        },
        selectCourts: function (item, selection, callback) {
            if (!lsport.map.selector.winCourts) {
                var cnt = $('<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-dialog" style="width: 500px"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>' + lsport.map.strings.AddAndSelectCourts + '</h3></div><div class="modal-body"><div class="form-group row"><div class="col-sm-offset-1 col-sm-10"><div class="input-group"><input type="text" class="form-control court-name" placeholder="' + lsport.map.strings.CourtNamesPlaceholder + '" /><span class="input-group-btn"><button class="btn btn-success btn-add-court" type="button"><span class="fas fa-plus"></span></button></span></div></div></div><div class="form-group row"><div class="col-sm-12"><div class="grid-courts"></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default">' + lsport.map.strings.Cancel + '</button><button type="button" class="btn btn-submit btn-success btn-lg">' + lsport.map.strings.UseCourts + '</button></div></div></div></div>').appendTo($("body"));
                lsport.map.selector.winCourts = cnt;
                lsport.map.selector.winCourts.complex = item;
                lsport.map.selector.winCourts.selection = selection;
                lsport.map.selector.winCourts.callback = callback;
                lsport.map.selector.winCourts.name = $("input.court-name");
                lsport.map.selector.winCourts.grid = cnt.find(".grid-courts").kendoGrid({
                    dataBound: function (e) {
                        var grid = e.sender;
                        $(grid.wrapper).find("button[data-court]").click(function (e) {
                            e.preventDefault();
                            $(e.currentTarget).closest("div.row").block(loaderSettings);
                            var courtID = $(e.currentTarget).attr("data-court");
                            lsport.map.editor.deleteCourt(courtID, function () {
                                var dataItem = grid.dataSource.get(courtID);
                                $(e.currentTarget).closest("div.row").unblock();
                                grid.dataSource.remove(dataItem);
                            }, function () {
                                $(e.currentTarget).closest("div.row").unblock();
                            });
                        });
                    },
                    dataSource: new kendo.data.DataSource({
                        type: "json",
                        serverPaging: true,
                        serverSorting: true,
                        serverFiltering: true,
                        transport: {
                            read: {
                                url: "/data/court/List",
                                dataType: "text",
                                type: "POST",
                                contentType: "application/json; charset=utf-8"
                            },
                            parameterMap: function (options) {
                                options.complexID = lsport.map.selector.winCourts.complex.ComplexID;
                                options.selection = lsport.map.selector.winCourts.selection;
                                return JSON.stringify(options);
                            }
                        },
                        sort: { field: "Text", dir: "asc" },
                        schema:
                        {
                            parse: function (resp) { return $.parseJSON(resp, true); },
                            data: function (resp) { return resp && resp.items ? resp.items : []; },
                            total: function (resp) { return resp && resp.total ? resp.total : 0; },
                            errors: function (resp) { return resp && resp.Message ? resp.Message : null; },
                            model: {
                                id: "ID"
                            }
                        }
                    }),
                    sortable: false,
                    scrollable: false,
                    filterable: false,
                    columns: [
                        { width: 40, title: " ", template: "<input type='checkbox' data-court='#=ID#' #if ($.inArray(ID, lsport.map.selector.winCourts.selection)+1) {# checked='checked' #}#>" },
                        { title: lsport.map.strings.Court, field: "Text" }
                        //,{ width: 40, title: " ", template: "<button class='btn btn-danger btn-xs' data-court='#=ID#'><span class='glyphicon glyphicon-trash'></span></button>" }
                    ]
                }).data("kendoGrid");
                cnt.find("button.btn-default").click(function (e) { lsport.map.selector.winCourts.modal('hide'); });
                cnt.find("button.btn-submit").click(function (e) {
                    lsport.map.selector.winCourts.modal('hide');
                    lsport.map.selector.winCourts.callback($.map(lsport.map.selector.winCourts.grid.wrapper.find("input[type=checkbox][data-court]:checked"), function (cb) {
                        return lsport.map.selector.winCourts.grid.dataItem($(cb).closest("tr"));
                    }));
                });
                var addCourt = function (e) {
                    if (e) e.preventDefault();
                    if (!$.trim(lsport.map.selector.winCourts.name.val())) {
                        alert(lsport.map.strings.CourtNameRequired);
                        return;
                    }
                    lsport.map.selector.winCourts.find(".modal-content").block(loaderSettings);
                    $.ajax({
                        type: "POST",
                        url: "/data/court/create",
                        data: JSON.stringify({
                            Name: $.trim(lsport.map.selector.winCourts.name.val()),
                            ComplexID: lsport.map.selector.winCourts.complex.ComplexID
                        }),
                        dataType: "json",
                        contentType: "application/json; charset=utf-8",
                        error: function (jqXhr) {
                            lsport.map.selector.winCourt.find(".modal-content").unblock();
                            var resp = JSON.parse(jqXhr.responseText);
                            if (resp.Message) alert(resp.ExceptionMessage ? resp.ExceptionMessage : (resp.MessageDetail ? resp.MessageDetail : resp.Message));
                            else if ($.isArray(resp)) {
                                alert($.map(resp, function (itm) { return itm.value; }).join("\n"));
                            }
                        },
                        success: function (resp) {
                            $.each(resp, function (i, crt) {
                                lsport.map.selector.winCourts.grid.dataSource.add(crt);
                            });
                            lsport.map.selector.winCourts.name.val("");
                            lsport.map.selector.winCourts.find(".modal-content").unblock();
                        }
                    });
                };
                cnt.find("button.btn-add-court").click(addCourt);
                lsport.map.selector.winCourts.name.keydown(function (e) {
                    if (e.keyCode == 13) {
                        addCourt();
                    }
                })
            } else {
                lsport.map.selector.winCourts.complex = item;
                lsport.map.selector.winCourts.selection = selection;
                lsport.map.selector.winCourts.callback = callback;
                lsport.map.selector.winCourts.grid.dataSource.read();
            }
            lsport.map.selector.winCourts.modal('show');
        },
        selectCourtsRO: function (item, selection, callback) {
            if (!lsport.map.selector.winCourtsRO) {
                var cnt = $('<div class="modal fade" data-backdrop="static" tabindex="-1" role="dialog"><div class="modal-dialog" style="width: 500px"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h3>' + lsport.map.strings.AddAndSelectCourts + '</h3></div><div class="modal-body"><div class="form-group row"><div class="col-sm-12"><div class="grid-courts"></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default">' + lsport.map.strings.Cancel + '</button><button type="button" class="btn btn-submit btn-success btn-lg">' + lsport.map.strings.UseCourts + '</button></div></div></div></div>').appendTo($("body"));
                lsport.map.selector.winCourtsRO = cnt;
                lsport.map.selector.winCourtsRO.complex = item;
                lsport.map.selector.winCourtsRO.selection = selection;
                lsport.map.selector.winCourtsRO.callback = callback;
                lsport.map.selector.winCourtsRO.grid = cnt.find(".grid-courts").kendoGrid({
                    dataBound: function (e) {
                        var grid = e.sender;
                        $(grid.wrapper).find("button[data-court]").click(function (e) {
                            e.preventDefault();
                            $(e.currentTarget).closest("div.row").block(loaderSettings);
                            var courtID = $(e.currentTarget).attr("data-court");
                            lsport.map.editor.deleteCourt(courtID, function () {
                                var dataItem = grid.dataSource.get(courtID);
                                $(e.currentTarget).closest("div.row").unblock();
                                grid.dataSource.remove(dataItem);
                            }, function () {
                                $(e.currentTarget).closest("div.row").unblock();
                            });
                        });
                    },
                    dataSource: new kendo.data.DataSource({
                        type: "json",
                        serverPaging: true,
                        serverSorting: true,
                        serverFiltering: true,
                        transport: {
                            read: {
                                url: "/data/court/List",
                                dataType: "text",
                                type: "POST",
                                contentType: "application/json; charset=utf-8"
                            },
                            parameterMap: function (options) {
                                options.complexID = lsport.map.selector.winCourtsRO.complex.ComplexID;
                                options.selection = lsport.map.selector.winCourtsRO.selection;
                                return JSON.stringify(options);
                            }
                        },
                        sort: { field: "Text", dir: "asc" },
                        schema:
                        {
                            parse: function (resp) { return $.parseJSON(resp, true); },
                            data: function (resp) { return resp && resp.items ? resp.items : []; },
                            total: function (resp) { return resp && resp.total ? resp.total : 0; },
                            errors: function (resp) { return resp && resp.Message ? resp.Message : null; },
                            model: {
                                id: "ID"
                            }
                        }
                    }),
                    sortable: false,
                    scrollable: false,
                    filterable: false,
                    columns: [
                        { width: 40, title: " ", template: "<input type='checkbox' data-court='#=ID#' #if ($.inArray(ID, lsport.map.selector.winCourtsRO.selection)+1) {# checked='checked' #}#>" },
                        { title: lsport.map.strings.Court, field: "Text" }
                        //,{ width: 40, title: " ", template: "<button class='btn btn-danger btn-xs' data-court='#=ID#'><span class='glyphicon glyphicon-trash'></span></button>" }
                    ]
                }).data("kendoGrid");
                cnt.find("button.btn-default").click(function (e) { lsport.map.selector.winCourtsRO.modal('hide'); });
                cnt.find("button.btn-submit").click(function (e) {
                    lsport.map.selector.winCourtsRO.modal('hide');
                    lsport.map.selector.winCourtsRO.callback($.map(lsport.map.selector.winCourtsRO.grid.wrapper.find("input[type=checkbox][data-court]:checked"), function (cb) {
                        return lsport.map.selector.winCourtsRO.grid.dataItem($(cb).closest("tr"));
                    }));
                });
            } else {
                lsport.map.selector.winCourtsRO.complex = item;
                lsport.map.selector.winCourtsRO.selection = selection;
                lsport.map.selector.winCourtsRO.callback = callback;
                lsport.map.selector.winCourtsRO.grid.dataSource.read();
            }
            lsport.map.selector.winCourtsRO.modal('show');
        }
    }
};